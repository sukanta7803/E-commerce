<%- include('../partials/header') %>

<div class="container">
  <div class="profile-page">
    <aside class="profile-sidebar">
      <nav class="profile-nav">
        <a href="/user/profile" class="active">Profile</a>
        <a href="/orders">My Orders</a>
        <a href="/user/addresses">Addresses</a>
         <a href="/auth/logout">Logout</a>
      </nav>
    </aside>

    <div class="profile-content">
      <h1>My Profile</h1>

      <div class="profile-section">
        <h2>Personal Information</h2>
        <form id="profile-form">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" name="name" value="<%= user.name %>" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" value="<%= user.email %>" disabled>
            <small>Email cannot be changed</small>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" name="phone" value="<%= user.phone || '' %>">
          </div>
          <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>
      </div>

      <div class="profile-section">
        <h2>Account Information</h2>
        <p>Member since: <%= new Date(user.createdAt).toLocaleDateString() %></p>
        <p>Loyalty Points: <strong><%= user.loyaltyPoints %></strong></p>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('profile-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  try {
    const response = await fetch('/user/profile/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    if (result.success) {
      alert('Profile updated successfully');
    } else {
      alert(result.message);
    }
  } catch (error) {
    alert('An error occurred');
  }
});
</script>

<%- include('../partials/footer') %>
