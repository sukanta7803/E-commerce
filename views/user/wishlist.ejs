<%- include('../partials/header') %>

<div class="container">
  <div class="profile-page">
    

    <div class="profile-content">
      <h1>My Wishlist</h1>

      <% if (products.length === 0) { %>
        <div class="empty-wishlist">
          <p>Your wishlist is empty</p>
          <a href="/products" class="btn btn-primary">Browse Products</a>
        </div>
      <% } else { %>
        <div class="products-grid">
          <% products.forEach(product => { %>
            <div class="product-card">
              <a href="/products/<%= product.slug %>">
                <div class="product-image">
                  <img src="<%= product.images[0]?.url || '/images/placeholder.jpg' %>" alt="<%= product.name %>">
                </div>
                <div class="product-info">
                  <h3><%= product.name %></h3>
                  <div class="product-price">
                    <% if (product.salePrice) { %>
                      <span class="original-price">$<%= product.price.toFixed(2) %></span>
                      <span class="sale-price">$<%= product.salePrice.toFixed(2) %></span>
                    <% } else { %>
                      <span class="price">$<%= product.price.toFixed(2) %></span>
                    <% } %>
                  </div>
                </div>
              </a>
              <div class="product-actions">
                <button class="btn btn-primary add-to-cart-btn" data-product-id="<%= product._id %>">Add to Cart</button>
                <button class="btn btn-secondary" onclick="removeFromWishlist('<%= product._id %>')">Remove</button>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>

<script>
async function removeFromWishlist(productId) {
  try {
    const response = await fetch(`/user/wishlist/remove/${productId}`, {
      method: 'DELETE'
    });

    const result = await response.json();
    if (result.success) {
      location.reload();
    } else {
      alert(result.message);
    }
  } catch (error) {
    alert('An error occurred');
  }
}
</script>

<%- include('../partials/footer') %>
