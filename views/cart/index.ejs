<%- include('../partials/header') %>

<div class="container">
  <h1>Shopping Cart</h1>

  <% if (!cart || items.length === 0) { %>
    <div class="empty-cart">
      <p>Your cart is empty</p>
      <a href="/products" class="btn btn-primary">Continue Shopping</a>
    </div>
  <% } else { %>
    <div class="cart-content">
      <div class="cart-items">
        <% items.forEach(item => { %>
          <div class="cart-item" data-item-id="<%= item._id %>">
            <div class="item-image">
              <img src="<%= item.product.images[0]?.url || '/images/placeholder.jpg' %>" alt="<%= item.product.name %>">
            </div>
            <div class="item-details">
              <h3><a href="/products/<%= item.product.slug %>"><%= item.product.name %></a></h3>
              <p class="item-price">$<%= item.price.toFixed(2) %></p>
            </div>
            <div class="item-quantity">
              <label>Quantity:</label>
              <input type="number" value="<%= item.quantity %>" min="1" max="<%= item.product.stock %>"
                onchange="updateCartItem('<%= item._id %>', this.value)">
            </div>
            <div class="item-total">
              <p>$<%= (item.price * item.quantity).toFixed(2) %></p>
            </div>
            <button class="btn-remove" onclick="removeCartItem('<%= item._id %>')">Remove</button>
          </div>
        <% }) %>
      </div>

      <div class="cart-summary">
        <h2>Order Summary</h2>
        <div class="summary-row">
          <span>Subtotal:</span>
          <span id="subtotal">$<%= cart.subtotal.toFixed(2) %></span>
        </div>
        <div class="summary-row">
          <span>Shipping:</span>
          <span>$10.00</span>
        </div>
        <div class="summary-row">
          <span>Tax (8%):</span>
          <span id="tax">$<%= (cart.subtotal * 0.08).toFixed(2) %></span>
        </div>
        <div class="summary-row total">
          <span>Total:</span>
          <span id="total">$<%= (cart.subtotal + 10 + cart.subtotal * 0.08).toFixed(2) %></span>
        </div>
        <a href="/orders/checkout" class="btn btn-primary btn-block">Proceed to Checkout</a>
        <a href="/products" class="btn btn-secondary btn-block">Continue Shopping</a>
      </div>
    </div>
  <% } %>
</div>

<%- include('../partials/footer') %>
