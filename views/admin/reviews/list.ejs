<%- include('../../partials/header') %>

<div class="container">
  <div class="admin-page">
    <aside class="admin-sidebar">
      <h2>Admin Panel</h2>
      <nav class="admin-nav">
        <a href="/admin/dashboard">Dashboard</a>
        <a href="/admin/products">Products</a>
        <a href="/admin/categories">Categories</a>
        <a href="/admin/orders">Orders</a>
        <a href="/admin/customers">Customers</a>
        <a href="/admin/reviews" class="active">Reviews</a>
      </nav>
    </aside>

    <div class="admin-content">
      <h1>Manage Reviews</h1>

      <div class="reviews-admin-list">
        <% reviews.forEach(review => { %>
          <div class="review-admin-card">
            <div class="review-admin-header">
              <div>
                <strong><%= review.product.name %></strong>
                <p>by <%= review.user.name %></p>
              </div>
              <div class="review-rating">
                <% for (let i = 0; i < review.rating; i++) { %>★<% } %>
                <% for (let i = review.rating; i < 5; i++) { %>☆<% } %>
              </div>
            </div>
            <h4><%= review.title %></h4>
            <p><%= review.comment %></p>
            <div class="review-admin-footer">
              <span><%= new Date(review.createdAt).toLocaleDateString() %></span>
              <% if (review.isVerifiedPurchase) { %>
                <span class="verified-badge">Verified Purchase</span>
              <% } %>
              <button class="btn-danger btn-small" onclick="deleteReview('<%= review._id %>')">Delete</button>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>
</div>

<script>
async function deleteReview(reviewId) {
  if (!confirm('Are you sure you want to delete this review?')) return;

  try {
    const response = await fetch(`/admin/reviews/${reviewId}`, {
      method: 'DELETE'
    });

    const result = await response.json();
    if (result.success) {
      alert('Review deleted successfully');
      location.reload();
    } else {
      alert(result.message);
    }
  } catch (error) {
    alert('An error occurred');
  }
}
</script>

<%- include('../../partials/footer') %>
